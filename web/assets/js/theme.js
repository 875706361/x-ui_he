// 主题切换功能
class ThemeManager {
    constructor() {
        // 从本地存储获取主题设置
        this.theme = localStorage.getItem('x-ui-theme') || 'light';
        this.init();
    }

    init() {
        // 应用保存的主题设置
        if (this.theme === 'dark') {
            document.body.classList.add('dark-theme');
        } else {
            document.body.classList.remove('dark-theme');
        }
        
        // 调用创建主题切换按钮
        this.createThemeSwitcher();
    }

    // 切换主题
    toggleTheme() {
        if (this.theme === 'light') {
            this.theme = 'dark';
            document.body.classList.add('dark-theme');
        } else {
            this.theme = 'light';
            document.body.classList.remove('dark-theme');
        }
        
        // 保存主题设置到本地存储
        localStorage.setItem('x-ui-theme', this.theme);
        
        // 更新主题切换按钮的图标
        this.updateSwitcherIcon();
    }

    // 创建主题切换按钮
    createThemeSwitcher() {
        // 如果已有切换按钮，则不再创建
        if (document.getElementById('theme-switcher')) {
            return;
        }
        
        // 创建主题切换按钮
        const switcher = document.createElement('div');
        switcher.id = 'theme-switcher';
        switcher.className = 'theme-switch';
        switcher.title = '切换主题';
        
        // 创建图标
        const icon = document.createElement('i');
        icon.className = 'theme-switch-icon anticon';
        
        // 根据当前主题设置图标
        if (this.theme === 'light') {
            icon.innerHTML = '<svg viewBox="64 64 896 896" focusable="false" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M512 327c-101.1 0-183 81.9-183 183s81.9 183 183 183 183-81.9 183-183-81.9-183-183-183zm0 298c-63.5 0-115-51.5-115-115s51.5-115 115-115 115 51.5 115 115-51.5 115-115 115zM316 327h-1c-4.4 0-8-3.6-8-8v-59.4c0-4.3 3.6-7.9 8-7.9h1c4.2 0 7.7 3.6 7.7 7.9V319c0 4.4-3.5 8-7.7 8zm-79.7-46h-1c-4.2 0-7.7-3.6-7.7-7.9v-31.9c0-4.3 3.5-7.9 7.7-7.9h1c4.4 0 8 3.6 8 7.9v31.9c0 4.3-3.6 7.9-8 7.9zm-56.1-38.9h-1c-4.2 0-7.7-3.5-7.7-7.7v-3.9c0-4.2 3.5-7.7 7.7-7.7h1c4.2 0 7.7 3.5 7.7 7.7v3.9c0 4.2-3.5 7.7-7.7 7.7zM792 327h-1c-4.4 0-8-3.6-8-8v-59.4c0-4.3 3.6-7.9 8-7.9h1c4.2 0 7.7 3.6 7.7 7.9V319c0 4.4-3.5 8-7.7 8zm79.7-46h-1c-4.2 0-7.7-3.6-7.7-7.9v-31.9c0-4.3 3.5-7.9 7.7-7.9h1c4.4 0 8 3.6 8 7.9v31.9c0 4.3-3.6 7.9-8 7.9zm56.1-38.9h-1c-4.2 0-7.7-3.5-7.7-7.7v-3.9c0-4.2 3.5-7.7 7.7-7.7h1c4.2 0 7.7 3.5 7.7 7.7v3.9c0 4.2-3.5 7.7-7.7 7.7zM454.5 829.8h-1c-4.2 0-7.7-3.5-7.7-7.7v-59.4c0-4.3 3.5-7.9 7.7-7.9h1c4.2 0 7.7 3.5 7.7 7.9v59.4c0 4.2-3.5 7.7-7.7 7.7zm57.8-6.9h-1c-4.4 0-8-3.6-8-8v-31.9c0-4.3 3.6-7.9 8-7.9h1c4.2 0 7.7 3.5 7.7 7.9V815c0 4.3-3.5 7.9-7.7 7.9zm56-6.8h-1c-4.2 0-7.7-3.6-7.7-7.9v-3.9c0-4.3 3.5-7.9 7.7-7.9h1c4.2 0 7.7 3.6 7.7 7.9v3.9c0 4.3-3.5 7.9-7.7 7.9z"></path></svg>';
        } else {
            icon.innerHTML = '<svg viewBox="64 64 896 896" focusable="false" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M821.6 205.8c-23.4-46.6-56.7-88.4-99-124.2a401.2 401.2 0 00-140.1-77.8c-26-8.1-52.7-13.9-80-17.3-97.2-12.4-191.2 4-273.6 47.6-82.4 43.6-149.5 110.7-193.1 193.1A401.86 401.86 0 0012 511.9c0 28 2.4 55.8 7.1 83.2 10.5 60.7 33.6 117.5 67.7 166.8 23.4 33.9 51.3 64 83.1 89.3 64.7 51.7 143.3 83.2 226.5 90.5 91.2 8 183.1-11 261-55.6 42-24 79.5-55.1 111-92.7 27.6-33 49.2-70 63.3-109.1 13.9-37.9 21.1-77.6 21.1-117.7 0.1-108.3-34.8-211.9-99.4-298.7-8.1-10.9-17-21.4-26.5-31.4-9.4-9.9 5.4 6.1 0 0zm-548.3 154a3.12 3.12 0 01-3-5.2c25.5-42.5 65.4-76.4 113.8-96.3 18.9-7.8 39-12.5 59.9-13.9 5.3-0.4 8.5 5.5 5.3 9.6a235.8 235.8 0 00-53.2 76.9c-1.6 3.7-5.1 6.2-9.1 6.3-39.4 0.9-74.4 16-100.6 36.5-3.2 2.4-7.7 0.9-9.4-2.4-1.2-2.3-2.3-4.7-3.5-7.1 0-0.1-0.2-0.5-0.2-0.4zm363.3 247.2c-1.6 0.3-3.6 0.3-5.5 0-51.4-9.1-97.3-47.8-110.6-97.7-14.6-54.7 10.1-112.1 58.5-139.1 3.9-2.2 9-1.1 11.5 2.5 2.7 3.9 10.5 18.2 15.7 36.3 1.3 4.5 4.6 8.3 9 10.3 53.4 24.1 79.6 55.4 87.1 93.4 0.5 2.7 0.8 5.4 0.8 8.1 0.2 41.5-27.5 77.7-66.5 86.2z"></path></svg>';
        }
        
        switcher.appendChild(icon);
        
        // 添加点击事件
        switcher.addEventListener('click', () => {
            this.toggleTheme();
        });
        
        // 添加到页面
        document.body.appendChild(switcher);
    }

    // 更新切换按钮图标
    updateSwitcherIcon() {
        const icon = document.querySelector('#theme-switcher .theme-switch-icon');
        if (!icon) return;
        
        if (this.theme === 'light') {
            icon.innerHTML = '<svg viewBox="64 64 896 896" focusable="false" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M512 327c-101.1 0-183 81.9-183 183s81.9 183 183 183 183-81.9 183-183-81.9-183-183-183zm0 298c-63.5 0-115-51.5-115-115s51.5-115 115-115 115 51.5 115 115-51.5 115-115 115zM316 327h-1c-4.4 0-8-3.6-8-8v-59.4c0-4.3 3.6-7.9 8-7.9h1c4.2 0 7.7 3.6 7.7 7.9V319c0 4.4-3.5 8-7.7 8zm-79.7-46h-1c-4.2 0-7.7-3.6-7.7-7.9v-31.9c0-4.3 3.5-7.9 7.7-7.9h1c4.4 0 8 3.6 8 7.9v31.9c0 4.3-3.6 7.9-8 7.9zm-56.1-38.9h-1c-4.2 0-7.7-3.5-7.7-7.7v-3.9c0-4.2 3.5-7.7 7.7-7.7h1c4.2 0 7.7 3.5 7.7 7.7v3.9c0 4.2-3.5 7.7-7.7 7.7zM792 327h-1c-4.4 0-8-3.6-8-8v-59.4c0-4.3 3.6-7.9 8-7.9h1c4.2 0 7.7 3.6 7.7 7.9V319c0 4.4-3.5 8-7.7 8zm79.7-46h-1c-4.2 0-7.7-3.6-7.7-7.9v-31.9c0-4.3 3.5-7.9 7.7-7.9h1c4.4 0 8 3.6 8 7.9v31.9c0 4.3-3.6 7.9-8 7.9zm56.1-38.9h-1c-4.2 0-7.7-3.5-7.7-7.7v-3.9c0-4.2 3.5-7.7 7.7-7.7h1c4.2 0 7.7 3.5 7.7 7.7v3.9c0 4.2-3.5 7.7-7.7 7.7zM454.5 829.8h-1c-4.2 0-7.7-3.5-7.7-7.7v-59.4c0-4.3 3.5-7.9 7.7-7.9h1c4.2 0 7.7 3.5 7.7 7.9v59.4c0 4.2-3.5 7.7-7.7 7.7zm57.8-6.9h-1c-4.4 0-8-3.6-8-8v-31.9c0-4.3 3.6-7.9 8-7.9h1c4.2 0 7.7 3.5 7.7 7.9V815c0 4.3-3.5 7.9-7.7 7.9zm56-6.8h-1c-4.2 0-7.7-3.6-7.7-7.9v-3.9c0-4.3 3.5-7.9 7.7-7.9h1c4.2 0 7.7 3.6 7.7 7.9v3.9c0 4.3-3.5 7.9-7.7 7.9z"></path></svg>';
        } else {
            icon.innerHTML = '<svg viewBox="64 64 896 896" focusable="false" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M821.6 205.8c-23.4-46.6-56.7-88.4-99-124.2a401.2 401.2 0 00-140.1-77.8c-26-8.1-52.7-13.9-80-17.3-97.2-12.4-191.2 4-273.6 47.6-82.4 43.6-149.5 110.7-193.1 193.1A401.86 401.86 0 0012 511.9c0 28 2.4 55.8 7.1 83.2 10.5 60.7 33.6 117.5 67.7 166.8 23.4 33.9 51.3 64 83.1 89.3 64.7 51.7 143.3 83.2 226.5 90.5 91.2 8 183.1-11 261-55.6 42-24 79.5-55.1 111-92.7 27.6-33 49.2-70 63.3-109.1 13.9-37.9 21.1-77.6 21.1-117.7 0.1-108.3-34.8-211.9-99.4-298.7-8.1-10.9-17-21.4-26.5-31.4-9.4-9.9 5.4 6.1 0 0zm-548.3 154a3.12 3.12 0 01-3-5.2c25.5-42.5 65.4-76.4 113.8-96.3 18.9-7.8 39-12.5 59.9-13.9 5.3-0.4 8.5 5.5 5.3 9.6a235.8 235.8 0 00-53.2 76.9c-1.6 3.7-5.1 6.2-9.1 6.3-39.4 0.9-74.4 16-100.6 36.5-3.2 2.4-7.7 0.9-9.4-2.4-1.2-2.3-2.3-4.7-3.5-7.1 0-0.1-0.2-0.5-0.2-0.4zm363.3 247.2c-1.6 0.3-3.6 0.3-5.5 0-51.4-9.1-97.3-47.8-110.6-97.7-14.6-54.7 10.1-112.1 58.5-139.1 3.9-2.2 9-1.1 11.5 2.5 2.7 3.9 10.5 18.2 15.7 36.3 1.3 4.5 4.6 8.3 9 10.3 53.4 24.1 79.6 55.4 87.1 93.4 0.5 2.7 0.8 5.4 0.8 8.1 0.2 41.5-27.5 77.7-66.5 86.2z"></path></svg>';
        }
    }
}

// 页面加载完成后初始化主题管理器
document.addEventListener('DOMContentLoaded', () => {
    window.themeManager = new ThemeManager();
});